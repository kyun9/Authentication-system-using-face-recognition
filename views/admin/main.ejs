<!DOCTYPE html>
<html lang="ko" ng-app="imgg">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>티켓 Mart</title>
    <link href="../stylesheets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
    <script src="controller/controller.js"></script>
    <script>
        function submit_check() {
      if (!password.value || !password_confirm.value) {
        alert('항목을 다시 한번 확인해보세요.');
        return false;
      }
      if (!(password.value == password_confirm.value)) {
        alert('비밀번호와 비밀번호 확인의 값이 다릅니다.');
        return false;
      }
      if (password.value == password_confirm.value) {
        alert('비밀번호가 변경되었습니다.');
        return true;
      }
    }

    function submit_check2() {
      if (!email.value) {
        alert('항목을 다시 한번 확인해보세요.');
        return false;
      }
      // if (email.value) {
      //   alert('이메일이 변경되었습니다.');
      //   return true;
      // }

    }
    </script>
    <style>
        .userImg {
            display: none;
        } 
        .userImg.on{
            display: inline-block;
        }
    </style>
</head>

<body ng-controller="helloants">

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"
                    aria-expanded="false">
                    <span class="sr-only"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">
                    <font style="font-weight: bold; font-size: 30px;  text-shadow: #FAED71 0.2em 0.2em 0.2em; color: black">티켓 Market</font>
                </a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
               
                <ul class="nav navbar-nav navbar-right">
                    
                    <li>
                        <a>
                            <font style="font-weight: bold; font-size: 20px;"> &nbsp;관리자님</font>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/admin/login">로그아웃</a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>
    <br><br><br>
    <div class="container">
        <ul id="myTab" class="nav nav-tabs" role="tablist">
            <li class="active">
                <a href="#userList">전체 유저</a>
            </li>
            <li>
                <a href="#concertList" class="manageImg">티켓 구매 유저</a>
            </li>
            
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="userList">
                <br><br><br>
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                    <h3 class="panel-title">
                                        <span>
                                            &nbsp;&nbsp;유저목록
                                        </span>
                                    </h3>
                                </div>
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>사용자 No.</th>
                                            <th>사용자 ID</th>
                                            <th>사용자 이미지</th >
                                            <th>사용자 관리</th >
                                    </thead>
                                    <tbody>
                                        <% users.forEach(function (users) { %>
                                        </tr>
                                        <tr>
                                            <td class="userIdTr"><%= users.id %></td>
                                            <td><%= users.username %></td>
                                            <td class="imgTr">
                                                <button class="showImg btn">이미지 보기</button>
                                                <img src="../<%= users.ImgPath %>" width="250" height="250" class="userImg"/>
                                            </td>
                                            <td>

                                                <button class="deleteUser btn" userid="<%= users.id %>">삭제</button>
                                            </td>
                                        </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                            
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane " id="concertList">
                    <br><br><br>
                    <div class="container">
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="panel panel-primary">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">
                                            <span>
                                                &nbsp;&nbsp;유저-티켓 목록
                                            </span>
                                        </h3>
                                    </div>
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>No.</th>
                                                <th>사용자 No.</th>
                                                <th>콘서트 No.</th>
                                                <th>구매일자</th >
                                                <th>티켓체크여부</th >
                                        </thead>
                                        <tbody>
                                            <% results.forEach(function (results) { %>
                                            </tr>
                                            <tr>
                                                <td class="id"><%= results.id %></td>
                                                <td class="u_id"><%= results.u_id %></td>
                                                <td class="c_id"><%= results.c_id %></td>
                                                <td class="buytime"><%= results.buytime %></td>
                                                <td class="ticketcheck"><%= results.ticketcheck %></td>
                                            </tr>
                                            <% }); %>
                                        </tbody>
                                    </table>
                                
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

        </div>

        
    </div>
    




    <br><br><br><br><br><br><br><br><br><br><br><br><br>

    <footer style="background-color: #FAED71; color: dark;">
        <div class="container">
            <br>
            <div class="row">
                <div class="col-sm-2">
                    <h5>Copyright &copy; 2018</h5>
                </div>
                <div class="col-sm-4">
                    <h5>Introduce</h5>
                    <p>현장 암표를 예방한 티켓팅하는 페이지입니다. <br> 안전한 티켓문화 권장합니다.</p>
                </div>

            </div>

        </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="../stylesheets/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script>
        $(function () {
            $('#myTab a:first').tab('show');
            
            $(document).delegate('.showImg.btn', 'click', function(){
                console.log('이미지버튼 클릭');
                $(this).parents().children('.userImg').toggleClass('on');
                $(this).hide();
            });

            $(document).delegate('.userImg', 'click', function(){
                $(this).toggleClass('on');
                $(this).parents().children('.showImg.btn').show();
            });

            $(document).delegate('.deleteUser.btn', 'click', function(){
                var userId = $(this).parent().siblings('.userIdTr').text();
                var cfirm = confirm("정말 삭제하시겠습니까?");
                
                if (cfirm) {
                    var userid = $(this).attr("userid");
                    window.location.href='/admin/deleteUser/'+userid;
                } else {
                    console.log('취소');
                }
            });
        });

        $('#myTab a').click(function (e) {
            e.preventDefault();
            $(this).tab('show');
        });

        function deleteUser(userID){
            var userId = userID;
            console.log("userId: ", userId);
            
            var params = {
                // Request parameters
                "id": userId
            };
            console.log("params.id: ", params.id);
            $.ajax({
                url: "http://210.102.181.158:62001/admin/deleteUser/" + $.param(params),
                // beforeSend: function (xhrObj) {
                //     // Request headers
                //     xhrObj.setRequestHeader("Content-Type", "application/json");
                // },
                type: "POST",
                async: false,
                complete: console.log("complete call json"),
                // Request body
                data: "",
                success: function(json){
                    console.log("success call json");
                    console.log("json: ", JSON.stringify(json));
                    console.log("json.userId: ", JSON.stringify(json.id));
                },
                error: function(err){
                    result = JSON.stringify(err);
                    console.log("error_message: ", result);
                    console.log(err);
                } 
            });
                
        }
      
    </script>
</body>

</html>